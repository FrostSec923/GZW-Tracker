<style>
@import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@700;900&family=Rajdhani:wght@400;600;700&display=swap');

* {margin:0;padding:0;box-sizing:border-box}

body {
  font-family:'Rajdhani',sans-serif;
  background:linear-gradient(135deg,#1a1a1a 0%,#2d2d2d 100%);
  color:#e0e0e0;
  min-height:100vh;
  padding:20px;
}

.container {
  max-width:1600px;
  margin:0 auto;
}

h1 {
  font-family:'Orbitron',monospace;
  font-size:2.5em;
  text-align:center;
  color:#ff6b35;
  text-transform:uppercase;
  letter-spacing:4px;
  text-shadow:0 0 20px rgba(255,107,53,0.5);
  margin-bottom:30px;
  animation:glow 2s ease-in-out infinite alternate;
}

@keyframes glow {
  from {text-shadow:0 0 20px rgba(255,107,53,0.5)}
  to {text-shadow:0 0 30px rgba(255,107,53,0.8),0 0 40px rgba(255,107,53,0.4)}
}

.tabs {
  display:flex;
  gap:10px;
  margin-bottom:30px;
  border-bottom:2px solid rgba(255,107,53,0.3);
  padding-bottom:10px;
  flex-wrap:wrap;
}

.tab {
  padding:12px 24px;
  background:rgba(45,45,45,0.8);
  border:2px solid rgba(255,107,53,0.3);
  color:#e0e0e0;
  cursor:pointer;
  border-radius:8px 8px 0 0;
  font-family:'Orbitron',monospace;
  font-weight:700;
  text-transform:uppercase;
  letter-spacing:2px;
  transition:all 0.3s;
  font-size:0.9em;
}

.tab:hover {
  background:rgba(255,107,53,0.2);
  border-color:#ff6b35;
  transform:translateY(-2px);
}

.tab.active {
  background:linear-gradient(135deg,#ff6b35 0%,#ff8c42 100%);
  border-color:#ff6b35;
  color:#1a1a1a;
  box-shadow:0 0 20px rgba(255,107,53,0.5);
}

.content {
  display:none;
  background:rgba(30,30,30,0.95);
  padding:30px;
  border-radius:12px;
  border:1px solid rgba(255,107,53,0.2);
  box-shadow:0 8px 32px rgba(0,0,0,0.4);
}

.content.active {
  display:block;
  animation:slideIn 0.3s ease-out;
}

@keyframes slideIn {
  from {opacity:0;transform:translateY(20px)}
  to {opacity:1;transform:translateY(0)}
}

h2 {
  font-family:'Orbitron',monospace;
  color:#ff6b35;
  margin-bottom:20px;
  font-size:1.8em;
  text-transform:uppercase;
  letter-spacing:3px;
  border-bottom:2px solid rgba(255,107,53,0.3);
  padding-bottom:10px;
}

h3 {
  font-family:'Orbitron',monospace;
  color:#ff6b35;
  margin:20px 0 10px 0;
  font-size:1.3em;
  text-transform:uppercase;
  letter-spacing:2px;
}

.stats-grid {
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
  gap:20px;
  margin-bottom:30px;
}

.stat {
  background:linear-gradient(135deg,rgba(255,107,53,0.1) 0%,rgba(255,140,66,0.05) 100%);
  padding:20px;
  border-radius:10px;
  border:2px solid rgba(255,107,53,0.3);
  text-align:center;
  transition:all 0.3s;
}

.stat:hover {
  transform:translateY(-5px);
  box-shadow:0 10px 30px rgba(255,107,53,0.3);
  border-color:#ff6b35;
}

.stat h3 {
  color:#999;
  font-size:0.9em;
  text-transform:uppercase;
  letter-spacing:2px;
  margin-bottom:10px;
  font-weight:600;
}

.stat .value {
  font-size:2.5em;
  font-weight:700;
  color:#ff6b35;
  font-family:'Orbitron',monospace;
  text-shadow:0 0 10px rgba(255,107,53,0.5);
}

label {
  display:block;
  color:#ff6b35;
  font-weight:600;
  text-transform:uppercase;
  font-size:0.9em;
  letter-spacing:1px;
  margin:15px 0 5px 0;
}

input,select,textarea {
  width:100%;
  padding:12px;
  background:rgba(20,20,20,0.8);
  border:2px solid rgba(255,107,53,0.3);
  color:#e0e0e0;
  border-radius:6px;
  font-family:'Rajdhani',sans-serif;
  font-size:1em;
  transition:all 0.3s;
}

input:focus,select:focus,textarea:focus {
  outline:none;
  border-color:#ff6b35;
  box-shadow:0 0 15px rgba(255,107,53,0.3);
  background:rgba(20,20,20,0.95);
}

textarea {
  min-height:80px;
  resize:vertical;
}

button {
  background:linear-gradient(135deg,#ff6b35 0%,#ff8c42 100%);
  color:#1a1a1a;
  padding:14px 32px;
  border:none;
  cursor:pointer;
  border-radius:8px;
  font-weight:700;
  text-transform:uppercase;
  letter-spacing:2px;
  font-family:'Orbitron',monospace;
  font-size:1em;
  margin-top:20px;
  transition:all 0.3s;
  box-shadow:0 4px 15px rgba(255,107,53,0.4);
  width:auto;
}

button:hover {
  transform:translateY(-3px);
  box-shadow:0 6px 25px rgba(255,107,53,0.6);
}

button:active {
  transform:translateY(0);
}

.btn-small {
  padding:8px 16px;
  font-size:0.85em;
  margin:5px;
}

.op-item {
  background:rgba(20,20,20,0.6);
  padding:20px;
  margin:15px 0;
  border-left:5px solid #ff6b35;
  border-radius:8px;
  transition:all 0.3s;
  border:1px solid rgba(255,107,53,0.2);
}

.op-item:hover {
  background:rgba(30,30,30,0.8);
  border-left-width:8px;
  transform:translateX(5px);
  box-shadow:0 5px 20px rgba(255,107,53,0.2);
}

.op-item strong {
  color:#ff6b35;
  font-size:1.2em;
  font-family:'Orbitron',monospace;
  text-transform:uppercase;
  letter-spacing:2px;
}

.op-item .status {
  display:inline-block;
  padding:4px 12px;
  border-radius:4px;
  font-weight:700;
  text-transform:uppercase;
  font-size:0.85em;
  margin-left:10px;
}

.status-survived {
  background:rgba(46,213,115,0.2);
  color:#2ed573;
  border:1px solid #2ed573;
}

.status-kia {
  background:rgba(255,71,87,0.2);
  color:#ff4757;
  border:1px solid #ff4757;
}

.status-mia {
  background:rgba(255,195,18,0.2);
  color:#ffc312;
  border:1px solid #ffc312;
}

.weapon-item {
  background:rgba(20,20,20,0.6);
  padding:10px 15px;
  margin:8px 0;
  border-left:3px solid #ff6b35;
  border-radius:6px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.weapon-item span {
  color:#e0e0e0;
}

.grid-2 {
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:20px;
  margin-bottom:20px;
}

.panel {
  background:rgba(20,20,20,0.4);
  padding:20px;
  border-radius:8px;
  border:1px solid rgba(255,107,53,0.2);
}

.map-container {
  position:relative;
  width:100%;
  max-width:100%;
  margin:20px auto;
  border:3px solid rgba(255,107,53,0.5);
  border-radius:8px;
  overflow:hidden;
  background:#000;
}

.map-container img {
  width:100%;
  height:auto;
  display:block;
}

.map-marker {
  position:absolute;
  width:20px;
  height:20px;
  border-radius:50%;
  border:3px solid #fff;
  cursor:pointer;
  transform:translate(-50%, -50%);
  transition:all 0.3s;
  box-shadow:0 0 15px rgba(0,0,0,0.8);
  z-index:10;
}

.map-marker:hover {
  transform:translate(-50%, -50%) scale(1.5);
  z-index:100;
}

.map-marker.survived {
  background:#2ed573;
  box-shadow:0 0 20px #2ed573;
}

.map-marker.kia {
  background:#ff4757;
  box-shadow:0 0 20px #ff4757;
}

.map-marker.mia {
  background:#ffc312;
  box-shadow:0 0 20px #ffc312;
}

.marker-tooltip {
  position:absolute;
  background:rgba(0,0,0,0.95);
  color:#fff;
  padding:10px 15px;
  border-radius:6px;
  border:2px solid #ff6b35;
  font-size:0.9em;
  pointer-events:none;
  z-index:1000;
  white-space:nowrap;
  display:none;
  font-family:'Rajdhani',sans-serif;
}

.marker-tooltip.show {
  display:block;
}

.map-controls {
  margin-bottom:15px;
  padding:15px;
  background:rgba(20,20,20,0.6);
  border-radius:8px;
  border:1px solid rgba(255,107,53,0.2);
}

.map-legend {
  display:flex;
  gap:20px;
  flex-wrap:wrap;
  align-items:center;
}

.legend-item {
  display:flex;
  align-items:center;
  gap:8px;
  font-size:0.9em;
}

.legend-dot {
  width:12px;
  height:12px;
  border-radius:50%;
  border:2px solid #fff;
}

@media(max-width:768px) {
  .grid-2 {
    grid-template-columns:1fr;
  }
}
</style>

<div class="container">
<h1>GZW OPERATIONS TRACKER</h1>

<div class="tabs">
  <div class="tab active" onclick="showTab('dash', event)">Dashboard</div>
  <div class="tab" onclick="showTab('new', event)">New Op</div>
  <div class="tab" onclick="showTab('map', event)">Map Intel</div>
  <div class="tab" onclick="showTab('loadout', event)">Loadout</div>
  <div class="tab" onclick="showTab('history', event)">History</div>
</div>

<div id="dash" class="content active">
<h2>Mission Control</h2>
<div class="stats-grid">
<div class="stat"><h3>Total Ops</h3><div class="value" id="totalOps">0</div></div>
<div class="stat"><h3>Survival Rate</h3><div class="value" id="survival">0%</div></div>
<div class="stat"><h3>Total Kills</h3><div class="value" id="totalKills">0</div></div>
<div class="stat"><h3>Total Profit</h3><div class="value" id="profit">$0</div></div>
</div>
<div id="recent"></div>
</div>

<div id="new" class="content">
<h2>Log New Operation</h2>
<label>Operator Name:</label>
<input type="text" id="player" placeholder="Enter your name or callsign" required>
<form id="opForm">
<label>Operation Codename:</label>
<input type="text" id="codename" placeholder="Operation Red Wing">

<label>Landing Zone (LZ):</label>
<input type="text" id="lz" placeholder="e.g., LZ Alpha, LZ Bravo, LZ Charlie" required>

<label>Primary Target / Objective:</label>
<input type="text" id="target" placeholder="e.g. Task for Handshake / Lab Rat / Gunny etc" required>

<label>Mission Result:</label>
<select id="result" required>
<option>Survived</option>
<option>KIA</option>
<option>MIA</option>
</select>

<label>Weapon:</label>
<select id="weapon" required>
<option value="">Select Weapon...</option>
</select>

<label>Ammo Type:</label>
<select id="ammo" required>
<option value="">Select Ammo...</option>
</select>

<label>Enemy Kills:</label>
<input type="number" id="kills" value="0" min="0">

<label>Net Profit ($):</label>
<input type="number" id="profitInput" value="0">

<label>Map Position (Optional - Click "Map Intel" tab to mark):</label>
<div style="display:flex;gap:10px;">
<input type="number" id="mapX" placeholder="X %" step="0.1" style="width:50%">
<input type="number" id="mapY" placeholder="Y %" step="0.1" style="width:50%">
</div>

<label>After Action Report (Notes):</label>
<textarea id="notes" placeholder="Mission intel, contact reports, lessons learned..."></textarea>

<button type="submit">LOG OPERATION</button>
</form>
</div>

<div id="map" class="content">
<h2>Map Intel</h2>

<div class="map-controls">
<div class="map-legend">
<span style="color:#ff6b35;font-weight:600;">LEGEND:</span>
<div class="legend-item">
<div class="legend-dot" style="background:#2ed573;"></div>
<span>Survived</span>
</div>
<div class="legend-item">
<div class="legend-dot" style="background:#ff4757;"></div>
<span>KIA</span>
</div>
<div class="legend-item">
<div class="legend-dot" style="background:#ffc312;"></div>
<span>MIA</span>
</div>
</div>
<p style="margin-top:10px;color:#999;font-size:0.9em;">
Click on the map while logging a new operation to mark your position. Hover over markers to see operation details.
</p>
</div>

<div class="map-container" id="mapContainer">
<img src="https://i.imgur.com/HOF8vhS.jpg" alt="GZW Map" id="mapImage">
<div id="mapMarkers"></div>
</div>

<div class="marker-tooltip" id="tooltip"></div>
</div>

<div id="loadout" class="content">
<h2>Loadout Manager</h2>

<div class="grid-2">
<div class="panel">
<h3>Weapons Arsenal</h3>
<input type="text" id="newWeapon" placeholder="Enter weapon name (e.g., M4A1)">
<button onclick="addWeapon()" class="btn-small">Add Weapon</button>
<div id="weaponList" style="margin-top:15px;"></div>
</div>

<div class="panel">
<h3>Ammo Types</h3>
<input type="text" id="newAmmo" placeholder="Enter ammo type (e.g., 5.56 NATO)">
<button onclick="addAmmo()" class="btn-small">Add Ammo</button>
<div id="ammoList" style="margin-top:15px;"></div>
</div>
</div>
</div>

<div id="history" class="content">
<h2>Operation History</h2>
<div id="opList"></div>
</div>

</div>

<script>
let ops = [];
google.script.run.withSuccessHandler(function(data) {
  ops = data;
  updateDash();
  updateHistory();
  renderMapMarkers();
}).getOperations();

let weapons = [];
let ammo = [];

google.script.run.withSuccessHandler(function(data){
  weapons = data;
  updateWeaponDropdown();
  updateWeaponList();
}).getWeapons();

google.script.run.withSuccessHandler(function(data){
  ammo = data;
  updateAmmoDropdown();
  updateAmmoList();
}).getAmmo();

function showTab(tab, ev) {
  document.querySelectorAll('.content').forEach(c => c.classList.remove('active'));
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  document.getElementById(tab).classList.add('active');
  ev.target.classList.add('active');

  if (tab === 'dash') updateDash();
  if (tab === 'history') updateHistory();
  if (tab === 'map') renderMapMarkers();
  if (tab === 'loadout') {
    updateWeaponList();
    updateAmmoList();
  }
  if (tab === 'new') {
    updateWeaponDropdown();
    updateAmmoDropdown();
  }
}

document.getElementById('mapImage').addEventListener('click', function(e) {
  const rect = this.getBoundingClientRect();
  const x = ((e.clientX - rect.left) / rect.width * 100).toFixed(2);
  const y = ((e.clientY - rect.top) / rect.height * 100).toFixed(2);
  
  document.getElementById('mapX').value = x;
  document.getElementById('mapY').value = y;
  
  alert('Position marked! X: ' + x + '%, Y: ' + y + '%\n\nNow go back to "New Op" tab to finish logging your operation.');
});

function renderMapMarkers() {
  const container = document.getElementById('mapMarkers');
  container.innerHTML = '';
  
  ops.filter(function(op) { return op.mapX && op.mapY; }).forEach(function(op) {
    const marker = document.createElement('div');
    marker.className = 'map-marker ' + op.result.toLowerCase();
    marker.style.left = op.mapX + '%';
    marker.style.top = op.mapY + '%';
    
    marker.addEventListener('mouseenter', function(e) {
      showTooltip(op, e);
    });
    
    marker.addEventListener('mouseleave', function() {
      hideTooltip();
    });
    
    marker.addEventListener('click', function() {
      alert('OPERATION: ' + op.codename + '\nLZ: ' + op.lz + '\nTarget: ' + op.target + '\nResult: ' + op.result + '\nLoadout: ' + op.weapon + ' / ' + op.ammo + '\nKills: ' + op.kills + '\nProfit: $' + op.profit.toLocaleString() + '\nTime: ' + op.time);
    });
    
    container.appendChild(marker);
  });
}

function showTooltip(op, e) {
  const tooltip = document.getElementById('tooltip');
  tooltip.innerHTML = '<strong>' + op.codename + '</strong><br>LZ: ' + op.lz + '<br>' + op.kills + ' kills | $' + op.profit.toLocaleString();
  tooltip.style.left = (e.pageX + 15) + 'px';
  tooltip.style.top = (e.pageY + 15) + 'px';
  tooltip.classList.add('show');
}

function hideTooltip() {
  document.getElementById('tooltip').classList.remove('show');
}

document.getElementById('opForm').onsubmit = function(e) {
  e.preventDefault();
  
  const op = {
    id: Date.now(),
    time: new Date().toLocaleString(),
    player: document.getElementById('player').value,
    codename: document.getElementById('codename').value || 'Op-' + Date.now(),
    lz: document.getElementById('lz').value,
    target: document.getElementById('target').value,
    result: document.getElementById('result').value,
    weapon: document.getElementById('weapon').value,
    ammo: document.getElementById('ammo').value,
    kills: parseInt(document.getElementById('kills').value) || 0,
    profit: parseInt(document.getElementById('profitInput').value) || 0,
    mapX: document.getElementById('mapX').value || null,
    mapY: document.getElementById('mapY').value || null,
    notes: document.getElementById('notes').value
  };

  google.script.run.withSuccessHandler(function() {
    alert('Operation logged to Google Sheets!');
    google.script.run.withSuccessHandler(function(data) {
      ops = data;
      updateDash();
      updateHistory();
      renderMapMarkers();
    }).getOperations();
  }).addOperation(op);

  this.reset();
  showTab('dash', {target: document.querySelector('.tab')});
};

function updateWeaponDropdown() {
  const select = document.getElementById('weapon');
  select.innerHTML = '<option value="">Select Weapon...</option>' + 
    weapons.sort().map(function(w) { return '<option>' + w + '</option>'; }).join('');
}

function updateAmmoDropdown() {
  const select = document.getElementById('ammo');
  select.innerHTML = '<option value="">Select Ammo...</option>' + 
    ammo.sort().map(function(a) { return '<option>' + a + '</option>'; }).join('');
}

function addWeapon() {
  const input = document.getElementById('newWeapon');
  const w = input.value.trim();
  if(w) {
    google.script.run.withSuccessHandler(function(data){
      weapons = data;
      updateWeaponList();
      updateWeaponDropdown();
    }).addWeapon(w);
    input.value = '';
  }
}

function removeWeapon(w) {
  if(confirm('Remove ' + w + '?')) {
    google.script.run.withSuccessHandler(function(data){
      weapons = data;
      updateWeaponList();
      updateWeaponDropdown();
    }).removeWeapon(w);
  }
}

function updateWeaponList() {
  document.getElementById('weaponList').innerHTML = weapons.sort().map(function(w) {
    return '<div class="weapon-item"><span>' + w + '</span><button onclick="removeWeapon(\'' + w + '\')" class="btn-small">Remove</button></div>';
  }).join('');
}

function addAmmo() {
  const input = document.getElementById('newAmmo');
  const a = input.value.trim();
  if(a) {
    google.script.run.withSuccessHandler(function(data){
      ammo = data;
      updateAmmoList();
      updateAmmoDropdown();
    }).addAmmo(a);
    input.value = '';
  }
}

function removeAmmo(a) {
  if(confirm('Remove ' + a + '?')) {
    google.script.run.withSuccessHandler(function(data){
      ammo = data;
      updateAmmoList();
      updateAmmoDropdown();
    }).removeAmmo(a);
  }
}

function updateAmmoList() {
  document.getElementById('ammoList').innerHTML = ammo.sort().map(function(a) {
    return '<div class="weapon-item"><span>' + a + '</span><button onclick="removeAmmo(\'' + a + '\')" class="btn-small">Remove</button></div>';
  }).join('');
}

function updateDash() {
  document.getElementById('totalOps').textContent = ops.length;
  const survived = ops.filter(function(o) { return o.result === 'Survived'; }).length;
  document.getElementById('survival').textContent = ops.length ? Math.round(survived/ops.length*100) + '%' : '0%';
  const totalProfit = ops.reduce(function(s, o) { return s + o.profit; }, 0);
  document.getElementById('profit').textContent = '$' + totalProfit.toLocaleString();
  const totalKills = ops.reduce(function(s, o) { return s + o.kills; }, 0);
  document.getElementById('totalKills').textContent = totalKills;
  
  document.getElementById('recent').innerHTML = '<h3>Recent Operations</h3>' + 
    ops.slice(0,5).map(function(o) {
      return '<div class="op-item"><strong>' + o.codename + '</strong> <span class="status status-' + o.result.toLowerCase() + '">' + o.result + '</span><br>LZ: ' + o.lz + ' | Target: ' + o.target + '<br>' + o.weapon + ' (' + o.ammo + ')<br>' + o.kills + ' kills | $' + o.profit.toLocaleString() + '<br>' + o.time + '</div>';
    }).join('');
}

function updateHistory() {
  document.getElementById('opList').innerHTML = ops.map(function(o) {
    return '<div class="op-item"><strong>' + o.codename + '</strong><span class="status status-' + o.result.toLowerCase() + '">' + o.result + '</span><br>LZ: ' + o.lz + ' | Target: ' + o.target + '<br>Loadout: ' + o.weapon + ' / ' + o.ammo + '<br>Kills: ' + o.kills + ' | Profit: $' + o.profit.toLocaleString() + '<br>' + (o.notes ? 'AAR: ' + o.notes + '<br>' : '') + o.time + '</div>';
  }).join('') || '<p style="text-align:center;color:#999;">No operations logged yet</p>';
}

updateWeaponDropdown();
updateAmmoDropdown();
updateDash();
</script>